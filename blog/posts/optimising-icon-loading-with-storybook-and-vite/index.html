<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How I optimised icon loading in Storybook and Vite</title>
    <meta name="description" content="A look into a recent project to reduce load times and optimise icon loading in Storybook using @storybook/builder-vite.">
    <meta name="color-scheme" content="light dark">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/shiki.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Andrew Leedham">
    <link rel="alternate" href="/blog/feed/feed.json" type="application/json" title="Andrew Leedham">
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/img/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">
  </head>
  <body>
   <script type="application/javascript">
      const currentMode = localStorage.getItem('mode');
      const colorSchemeTag = document.querySelector('meta[name="color-scheme"]');

      if (currentMode === 'dark') {
        document.body.classList.toggle('dark-mode');
        colorSchemeTag.setAttribute('content', 'dark')
      } else if (currentMode === 'light') {
        document.body.classList.toggle('light-mode');
        colorSchemeTag.setAttribute('content', 'light')
      }

      window.toggleMode = () => {
        const systemLevelDark = window.matchMedia('(prefers-color-scheme: dark)');
        const colorSchemeTag = document.querySelector('meta[name="color-scheme"]');
        let mode;
        if (systemLevelDark.matches) {
          document.body.classList.toggle('light-mode');
          mode = document.body.classList.contains('light-mode') ? 'light' : 'dark';
        } else {
          document.body.classList.toggle('dark-mode');
          mode = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
        }
        localStorage.setItem('mode', mode);
        colorSchemeTag.setAttribute('content', mode)
      }
    </script>
    
      <header class="header">
          <a id="logoLink" href="/" aria-label="Go to the Andrew Leedham homepage"><svg id="logoAnimated" class="logo--animated" height="48px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 362 108.04">
        <title>Andrew Leedham</title>
        <path id="a-andrew" fill="currentColor" d="M61.59 108l-3.7-20H36.64l-3.39 20H15.54L35.1 11.9h23.87L79.46 108ZM38.95 74.83h16.48l-8.47-46Z">
            <animate id="aStart" attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M61.59 108l-3.7-20H36.64l-3.39 20H15.54L35.1 11.9h23.87L79.46 108ZM38.95 74.83h16.48l-8.47-46Z"/>
            <animate id="aEnd" attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M47.09,37.56l-1.35-7.39H38l-1.24,7.39H30.23L37.39,2h8.74l7.5,35.59ZM38.8,25.26h6l-3.1-17Z"/>
        </path>
        <path id="n-andrew" fill="currentColor" d="M53.51 19h.53q1.8 0 1.8 3.74V37.56h-2V23.35a2.07 2.07 0 00-.11-.81.39.39 0 00-.39-.21h-.53q-.54 0-.54 1.25v14h-2V19h2v1.7Q52.51 19 53.51 19Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M53.51 19h.53q1.8 0 1.8 3.74V37.56h-2V23.35a2.07 2.07 0 00-.11-.81.39.39 0 00-.39-.21h-.53q-.54 0-.54 1.25v14h-2V19h2v1.7Q52.51 19 53.51 19Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M66.83,9.86h1.69q5.81,0,5.81,5.58V37.56H67.9V16.35a1.64,1.64,0,0,0-.34-1.21,1.87,1.87,0,0,0-1.24-.31H64.63q-1.75,0-1.75,1.86V37.56H56.51V9.86h6.32V12.4Q63.62,9.86,66.83,9.86Z"/>
        </path>
        <path id="d-andrew" fill="currentColor" d="M53.84 12.4h2V37.56h-2V35.71q-.21 1.85-1.24 1.85h-.54q-1.79 0-1.79-3.74V22.71q0-3.74 1.79-3.74h.54q.95 0 1.21 1.59ZM52.74 34.23h.53q.54 0 .54-1.25V23.58a2.82 2.82 0 00-.12-1 .43.43 0 00-.42-.28H52.74a.39.39 0 00-.39.21 2.07 2.07 0 00-.11.81v9.9a2.07 2.07 0 00.11.81A.39.39 0 0052.74 34.23Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M53.84 12.4h2V37.56h-2V35.71q-.21 1.85-1.24 1.85h-.54q-1.79 0-1.79-3.74V22.71q0-3.74 1.79-3.74h.54q.95 0 1.21 1.59ZM52.74 34.23h.53q.54 0 .54-1.25V23.58a2.82 2.82 0 00-.12-1 .43.43 0 00-.42-.28H52.74a.39.39 0 00-.39.21 2.07 2.07 0 00-.11.81v9.9a2.07 2.07 0 00.11.81A.39.39 0 0052.74 34.23Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M90,0h6.43V37.56H90.13V34.79q-.68,2.76-4,2.76H84.37q-5.75,0-5.75-5.58V15.39q0-5.58,5.75-5.58h1.75q3,0,3.89,2.37ZM86.57,32.59h1.69q1.75,0,1.75-1.86v-14a2.2,2.2,0,0,0-.4-1.49,1.8,1.8,0,0,0-1.35-.42H86.57a1.87,1.87,0,0,0-1.24.31A1.64,1.64,0,0,0,85,16.29V31.07a1.64,1.64,0,0,0,.34,1.21A1.86,1.86,0,0,0,86.57,32.59Z"/>
        </path>
        <path id="r-andrew" fill="currentColor" d="M53.81 18.93h.32v3.7h-.74q-1.1 0-1.1 2.72v12.2h-2V19h2v2.38a4.63 4.63 0 01.54-1.78A1.16 1.16 0 0153.81 18.93Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M53.81 18.93h.32v3.7h-.74q-1.1 0-1.1 2.72v12.2h-2V19h2v2.38a4.63 4.63 0 01.54-1.78A1.16 1.16 0 0153.81 18.93Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M112.52,9.75h1v5.53h-2.37q-3.55,0-3.55,4.06V37.56h-6.37V9.86h6.32v3.55a4.94,4.94,0,0,1,1.75-2.65A5.06,5.06,0,0,1,112.52,9.75Z"/>
        </path>
        <path id="e-andrew" fill="currentColor" d="M52.15 19h1.86q1.89 0 1.89 3.74v6.76h-3.73v3.82a2.24 2.24 0 00.1.81.39.39 0 00.39.21h.81a.39.39 0 00.39-.21 2.07 2.07 0 00.11-.81v-1.4h1.93v1.89q0 3.74-1.91 3.74h-1.82q-1.91 0-1.91-3.74V22.75Q50.24 19 52.15 19Zm0 7.75h1.82V23.2a2.07 2.07 0 00-.11-.81.39.39 0 00-.39-.21h-.84a.39.39 0 00-.39.21 2.07 2.07 0 00-.11.81Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M52.15 19h1.86q1.89 0 1.89 3.74v6.76h-3.73v3.82a2.24 2.24 0 00.1.81.39.39 0 00.39.21h.81a.39.39 0 00.39-.21 2.07 2.07 0 00.11-.81v-1.4h1.93v1.89q0 3.74-1.91 3.74h-1.82q-1.91 0-1.91-3.74V22.75Q50.24 19 52.15 19Zm0 7.75h1.82V23.2a2.07 2.07 0 00-.11-.81.39.39 0 00-.39-.21h-.84a.39.39 0 00-.39.21 2.07 2.07 0 00-.11.81Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M122.11,9.86h6q6.09,0,6.09,5.58v10.1h-12v5.7a1.74,1.74,0,0,0,.31,1.21,1.85,1.85,0,0,0,1.27.31h2.59a1.86,1.86,0,0,0,1.24-.31,1.64,1.64,0,0,0,.34-1.21V29.15h6.2V32q0,5.58-6.15,5.58h-5.87Q116,37.56,116,32V15.45Q116,9.86,122.11,9.86Zm.06,11.56H128v-5.3a1.64,1.64,0,0,0-.34-1.21,1.87,1.87,0,0,0-1.24-.31h-2.71a1.87,1.87,0,0,0-1.24.31,1.64,1.64,0,0,0-.34,1.21Z"/>
        </path>
        <path id="w-andrew" fill="currentColor" d="M58.4 19h1.86l-1.68 18.55H56.24l-1-13.11-1 13.11h-2.33L50.22 19h1.86l1 14.47L54.2 19h2.08l1.05 14.43Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M58.4 19h1.86l-1.68 18.55H56.24l-1-13.11-1 13.11h-2.33L50.22 19h1.86l1 14.47L54.2 19h2.08l1.05 14.43Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M162.55,9.86h6l-5.42,27.7h-7.5L152.29,18,149,37.56h-7.5l-5.25-27.7h6l3.21,21.6L149,9.86h6.71l3.38,21.55Z"/>
        </path>
        <path id="l-leedham" fill="currentColor" d="M65.04 106.51h4.83V108H61.74V97.36h3.31Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M65.04 106.51h4.83V108H61.74V97.36h3.31Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M27.9,85.76H47.73V96.14H14.33V23.8H27.9Z"/>
        </path>
        <path id="e-leedham" fill="currentColor" d="M64.87 99.8h3q3.11 0 3.11 1.72v3.12h-6.13v1.45a.4.4 0 00.16.37 1.43 1.43 0 00.65.1h1.32a1.44 1.44 0 00.63-.1.39.39 0 00.17-.37v-.64h3.17v.87q0 1.72-3.14 1.72h-3q-3.14 0-3.14-1.72v-4.79Q61.74 99.8 64.87 99.8Zm0 3.57h3v-1.64a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1H65.74a1.44 1.44 0 00-.63.1.39.39 0 00-.17.37Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M64.87 99.8h3q3.11 0 3.11 1.72v3.12h-6.13v1.45a.4.4 0 00.16.37 1.43 1.43 0 00.65.1h1.32a1.44 1.44 0 00.63-.1.39.39 0 00.17-.37v-.64h3.17v.87q0 1.72-3.14 1.72h-3q-3.14 0-3.14-1.72v-4.79Q61.74 99.8 64.87 99.8Zm0 3.57h3v-1.64a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1H65.74a1.44 1.44 0 00-.63.1.39.39 0 00-.17.37Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M65.43,40.32H77.94q12.75,0,12.75,11.68V73.13H65.55v9.79a3.64,3.64,0,0,0,.65,2.54,3.87,3.87,0,0,0,2.66.65h5.43a3.9,3.9,0,0,0,2.6-.65,3.43,3.43,0,0,0,.71-2.54V78.56h13v5.9q0,11.68-12.86,11.68H65.43q-12.86,0-12.86-11.68V52Q52.57,40.32,65.43,40.32Zm.12,24.19H77.82V53.42a3.43,3.43,0,0,0-.71-2.54,3.91,3.91,0,0,0-2.6-.65H68.85a3.9,3.9,0,0,0-2.6.65,3.43,3.43,0,0,0-.71,2.54Z"/>
        </path>
        <path id="e2-leedham" fill="currentColor" d="M64.87 99.8h3q3.11 0 3.11 1.72v3.12h-6.13v1.45a.4.4 0 00.16.37 1.43 1.43 0 00.65.1h1.32a1.44 1.44 0 00.63-.1.39.39 0 00.17-.37v-.64h3.17v.87q0 1.72-3.14 1.72h-3q-3.14 0-3.14-1.72v-4.79Q61.74 99.8 64.87 99.8Zm0 3.57h3v-1.64a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1H65.74a1.44 1.44 0 00-.63.1.39.39 0 00-.17.37Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M64.87 99.8h3q3.11 0 3.11 1.72v3.12h-6.13v1.45a.4.4 0 00.16.37 1.43 1.43 0 00.65.1h1.32a1.44 1.44 0 00.63-.1.39.39 0 00.17-.37v-.64h3.17v.87q0 1.72-3.14 1.72h-3q-3.14 0-3.14-1.72v-4.79Q61.74 99.8 64.87 99.8Zm0 3.57h3v-1.64a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1H65.74a1.44 1.44 0 00-.63.1.39.39 0 00-.17.37Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M111.69,40.32H124.2q12.75,0,12.75,11.68V73.13H111.81v9.79a3.64,3.64,0,0,0,.65,2.54,3.87,3.87,0,0,0,2.66.65h5.43a3.9,3.9,0,0,0,2.6-.65,3.43,3.43,0,0,0,.71-2.54V78.56h13v5.9q0,11.68-12.86,11.68H111.69q-12.86,0-12.86-11.68V52Q98.83,40.32,111.69,40.32Zm.12,24.19h12.27V53.42a3.43,3.43,0,0,0-.71-2.54,3.91,3.91,0,0,0-2.6-.65h-5.67a3.9,3.9,0,0,0-2.6.65,3.43,3.43,0,0,0-.71,2.54Z"/>
        </path>
        <path id="d-leedham" fill="currentColor" d="M67.65 97.36h3.28V108H67.74v-.85q-.35.85-2 .85H64.74q-2.93 0-2.93-1.72v-4.81q0-1.72 2.93-1.72h.89q1.55 0 2 .73Zm-1.76 9.15H66.74q.89 0 .89-.57v-4a.51.51 0 00-.2-.46 1.34 1.34 0 00-.69-.13h-.86a1.44 1.44 0 00-.63.1.39.39 0 00-.17.37V106a.39.39 0 00.17.37A1.44 1.44 0 0065.89 106.51Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M67.65 97.36h3.28V108H67.74v-.85q-.35.85-2 .85H64.74q-2.93 0-2.93-1.72v-4.81q0-1.72 2.93-1.72h.89q1.55 0 2 .73Zm-1.76 9.15H66.74q.89 0 .89-.57v-4a.51.51 0 00-.2-.46 1.34 1.34 0 00-.69-.13h-.86a1.44 1.44 0 00-.63.1.39.39 0 00-.17.37V106a.39.39 0 00.17.37A1.44 1.44 0 0065.89 106.51Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M168.7,23.8h13.45V96.14H168.93V90.36q-1.42,5.78-8.38,5.78h-3.66q-12,0-12-11.68V51.89q0-11.68,12-11.68h3.66q6.37,0,8.14,5Zm-7.2,62H165q3.66,0,3.66-3.89V54.6a4.6,4.6,0,0,0-.83-3.13,3.76,3.76,0,0,0-2.83-.89H161.5a3.9,3.9,0,0,0-2.6.65,3.43,3.43,0,0,0-.71,2.54v28.8a3.43,3.43,0,0,0,.71,2.54A3.9,3.9,0,0,0,161.5,85.76Z"/>
        </path>
        <path id="h-leedham" fill="currentColor" d="M67.1 99.8h.86q3 0 3 1.72V108h-3.28V101.8a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1h-.86q-.89 0-.89.58V108H61.84V97.36h3.25v3.17Q65.52 99.8 67.1 99.8Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M67.1 99.8h.86q3 0 3 1.72V108h-3.28V101.8a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1h-.86q-.89 0-.89.58V108H61.84V97.36h3.25v3.17Q65.52 99.8 67.1 99.8Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M213.78,40.32h3.54q12.15,0,12.16,11.68V96.14H216V53.89a3.43,3.43,0,0,0-.71-2.54,3.91,3.91,0,0,0-2.6-.65h-3.54q-3.66,0-3.66,3.9V96.14H192.18V23.8h13.34V45.28Q207.29,40.32,213.78,40.32Z"/>
        </path>
        <path id="a-leedham" fill="currentColor" d="M67.74 99.8h3.22V108h-3.28v-.73q-.43.73-2 .73H64.74q-2.93 0-2.93-1.72v-4.79q0-1.72 2.93-1.72h.89q1.7 0 2 .84Zm-1.81 6.71H66.74q.89 0 .89-.57v-4q0-.58-.89-.58h-.86a1.44 1.44 0 00-.63.1.39.39 0 00-.17.37V106a.39.39 0 00.17.37A1.44 1.44 0 0065.89 106.51Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M67.74 99.8h3.22V108h-3.28v-.73q-.43.73-2 .73H64.74q-2.93 0-2.93-1.72v-4.79q0-1.72 2.93-1.72h.89q1.7 0 2 .84Zm-1.81 6.71H66.74q.89 0 .89-.57v-4q0-.58-.89-.58h-.86a1.44 1.44 0 00-.63.1.39.39 0 00-.17.37V106a.39.39 0 00.17.37A1.44 1.44 0 0065.89 106.51Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M262.52,40.32h13.22V96.14H262.28v-5q-1.77,5-8.14,5h-3.66q-12,0-12-11.68V52q0-11.68,12-11.68h3.66q7,0,8.38,5.66Zm-7.43,45.44h3.54q3.66,0,3.66-3.89V54.6q0-3.9-3.66-3.9h-3.54a3.9,3.9,0,0,0-2.6.65,3.43,3.43,0,0,0-.71,2.54V82.57a3.43,3.43,0,0,0,.71,2.54A3.9,3.9,0,0,0,255.08,85.76Z"/>
        </path>
        <path id="m-leedham" fill="currentColor" d="M72.91 99.8h.89q2.93 0 2.93 1.72V108h-3.25V101.8a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1h-.86q-.89 0-.89.58V108h-3.28V101.8a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1h-.86q-.89 0-.89.58V108H61.84V99.8h3.22v.78q.4-.78 2-.78h.86q2.13 0 2.7.87Q71.07 99.8 72.91 99.8Z">
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="M72.91 99.8h.89q2.93 0 2.93 1.72V108h-3.25V101.8a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1h-.86q-.89 0-.89.58V108h-3.28V101.8a.39.39 0 00-.17-.37 1.44 1.44 0 00-.63-.1h-.86q-.89 0-.89.58V108H61.84V99.8h3.22v.78q.4-.78 2-.78h.86q2.13 0 2.7.87Q71.07 99.8 72.91 99.8Z"/>
            <animate attributeName="d" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="M331.2,40.32h3.66q12,0,12,11.68V96.14H333.56V53.89a3.43,3.43,0,0,0-.71-2.54,3.91,3.91,0,0,0-2.6-.65h-3.54q-3.66,0-3.66,3.9V96.14H309.61V53.89a3.43,3.43,0,0,0-.71-2.54,3.91,3.91,0,0,0-2.6-.65h-3.54q-3.66,0-3.66,3.9V96.14H285.77V40.32H299v5.31q1.65-5.31,8.38-5.31h3.54q8.73,0,11.09,5.9Q323.65,40.32,331.2,40.32Z"/>
        </path>
        <polygon id="right" fill="currentColor" points="87.75 11.94 63.13 11.94 64.72 19.52 87.75 19.52 87.75 100.46 81.81 100.46 83.38 108.04 95.78 108.04 95.78 107.96 95.78 100.46 95.78 19.52 95.78 11.94 87.75 11.94">
            <animate attributeName="points" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="87.75 11.94 63.13 11.94 64.72 19.52 87.75 19.52 87.75 100.46 81.81 100.46 83.38 108.04 95.78 108.04 95.78 107.96 95.78 100.46 95.78 19.52 95.78 11.94 87.75 11.94"/>
            <animate attributeName="points" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="353.98 11.94 172.44 11.94 171.02 19.52 353.98 19.52 353.98 100.46 348.03 100.46 349.6 108.04 362 108.04 362 107.96 362 100.46 362 19.52 362 11.94 353.98 11.94"/>
        </polygon>
        <polygon id="bottom" fill="currentColor" points="55.82 100.46 57.22 108 37.72 108.04 38.97 100.46 55.82 100.46">
            <animate attributeName="points" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="55.82 100.46 57.22 108 37.72 108.04 38.97 100.46 55.82 100.46"/>
            <animate attributeName="points" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="353.98 100.46 353.98 108.04 7.83 108.04 8 100.46 353.98 100.46"/>
        </polygon>
        <polygon id="left" fill="currentColor" points="29.52 19.55 31.09 11.97 8.03 11.95 8.03 11.94 0 11.94 0 19.52 0 100.38 0 107.96 8.03 107.96 11.72 107.96 13.21 100.38 8.03 100.38 8.03 19.52 29.52 19.55">
            <animate attributeName="points" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseleave" to="29.52 19.55 31.09 11.97 8.03 11.95 8.03 11.94 0 11.94 0 19.52 0 100.38 0 107.96 8.03 107.96 11.72 107.96 13.21 100.38 8.03 100.38 8.03 19.52 29.52 19.55"/>
            <animate attributeName="points" dur="100ms" fill="freeze" repeatCount="1" begin="logoAnimated.mouseenter;" to="29.52 19.55 31.08 11.97 8.02 11.95 8.02 11.94 0 11.94 0 19.52 0 100.38 0 107.96 8.02 107.96 11.72 107.96 13.21 100.38 8.02 100.38 8.02 19.52 29.52 19.55"/>
        </polygon>
    </svg><svg class="logo--small" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="48px" height="48px"><path fill="currentColor" d="m41.12 64-2.43-13.29h-14L22.45 64H10.78L23.67 0H39.4l13.49 64ZM26.21 41.88h10.85l-5.58-30.64ZM58.42-.02H42.29l1.04 5.05h15.09v53.92h-3.96L55.51 64h8.26V-.02h-5.35z"/><path fill="currentColor" d="m37.41 58.95.94 5.05H25.36l.83-5.05h11.22zM19.9 5.05 20.94 0 5.58-.01v-.01H.23V63.94h7.81l.99-5.04H5.58V5.03l14.32.02z"/></svg></a>
          <script type="application/javascript">
            const logoLink = document.getElementById('logoLink');
            const animations = Array.from(logoLink.getElementsByTagName('animate'));
            if (animations.length) {
              logoLink.addEventListener('focus', () => {
                const svg = logoLink.querySelector('svg');
                if (!logoLink.matches(':hover')) {
                  if (svg) {
                    svg.id = '';
                  }
                  animations.forEach((animation, index) => index % 2 !== 0 && animation.beginElement());
                }
              })
              logoLink.addEventListener('blur', () => {
                const svg = logoLink.querySelector('svg');
                if (!logoLink.matches(':hover')) {
                  if (svg) {
                    svg.id = 'logoAnimated';
                  }
                  animations.forEach((animation, index) => index % 2 === 0 && animation.beginElement());
                }
              })
            }
          </script>
          <ul class="nav">
              <li class="nav-item">
                <a href="/">Home</a>
              </li>
              <li class="nav-item">
                <a href="/blog/posts/">Blog</a>
              </li>
          </ul>
          <button aria-label="Toggle Colour Mode" class="button button--mode-toggle" onclick="window.toggleMode()">
            <svg style="width:24px;height:24px" viewBox="0 0 24 24">
              <path fill="currentColor" d="M3.55,18.54L4.96,19.95L6.76,18.16L5.34,16.74M11,22.45C11.32,22.45 13,22.45 13,22.45V19.5H11M12,5.5A6,6 0 0,0 6,11.5A6,6 0 0,0 12,17.5A6,6 0 0,0 18,11.5C18,8.18 15.31,5.5 12,5.5M20,12.5H23V10.5H20M17.24,18.16L19.04,19.95L20.45,18.54L18.66,16.74M20.45,4.46L19.04,3.05L17.24,4.84L18.66,6.26M13,0.55H11V3.5H13M4,10.5H1V12.5H4M6.76,4.84L4.96,3.05L3.55,4.46L5.34,6.26L6.76,4.84Z" />
            </svg>
            <svg style="width:24px;height:24px" viewBox="0 0 24 24">
              <path fill="currentColor" d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z" />
            </svg>
          </button>
      </header>
    

    <main class="tmpl-post">
      <section>
  <h1>How I optimised icon loading in Storybook and Vite</h1>

  <time datetime="2022-07-24">24 Jul 2022</time><a href="/blog/tags/web/" class="post-tag">web</a><a href="/blog/tags/javascript/" class="post-tag">javascript</a><a href="/blog/tags/storybook/" class="post-tag">storybook</a><a href="/blog/tags/vite/" class="post-tag">vite</a><a href="/blog/tags/optimisation/" class="post-tag">optimisation</a>

  <h2 id="the-problem" tabindex="-1">The Problem <a class="direct-link" href="#the-problem" aria-hidden="true">#</a></h2>
<p>For the purposes of this blog post the <a href="https://storybook.js.org/">Storybook</a> in question is a React based component library using <a href="https://vitejs.dev/">Vite</a> as the <a href="https://github.com/storybookjs/builder-vite">Storybook builder</a>. It is unfortunately closed source, but I will provide some working code based on it in this blog post. The icons are each their own React components along the lines of:</p>
<div style='display: none'>
<pre><code class="language-twoslash">// @filename: IconBase.tsx
import React from &quot;react&quot;;
export type IconProps = Omit&lt;JSX.IntrinsicElements[&quot;svg&quot;], 'ref'&gt;;

export default function IconBase(props: IconProps) {
  const { children, ...rest } = props;
  return (
    &lt;svg viewBox=&quot;...&quot; width=&quot;..&quot; height=&quot;..&quot; {...props}&gt;
      {children}
    &lt;/svg&gt;
  );
}
</code></pre>
<pre><code class="language-twoslash">// @filename: IconBase.tsx
import React from &quot;react&quot;;
export type IconProps = Omit&lt;JSX.IntrinsicElements[&quot;svg&quot;], 'ref'&gt;;

export default function IconBase(props: IconProps) {
  const { children, ...rest } = props;
  return (
    &lt;svg viewBox=&quot;...&quot; width=&quot;..&quot; height=&quot;..&quot; {...props}&gt;
      {children}
    &lt;/svg&gt;
  );
}
// ---cut---
// @filename: icons/LightBulb.tsx
import React from &quot;react&quot;;
import IconBase, { IconProps } from &quot;../IconBase&quot;;

export default function LightBulbIcon(props: IconProps) {
  return (
    &lt;IconBase&gt;
      &lt;path d=&quot;...&quot;&gt;&lt;/path&gt;
    &lt;/IconBase&gt;
  );
}
</code></pre>
<pre><code class="language-twoslash">// @filename: IconBase.tsx
import React from &quot;react&quot;;
export type IconProps = Omit&lt;JSX.IntrinsicElements[&quot;svg&quot;], 'ref'&gt;;

export default function IconBase(props: IconProps) {
  const { children, ...rest } = props;
  return (
    &lt;svg viewBox=&quot;...&quot; width=&quot;..&quot; height=&quot;..&quot; {...props}&gt;
      {children}
    &lt;/svg&gt;
  );
}
// @filename: useIcon.tsx
/// &lt;reference types=&quot;vite/client&quot; /&gt;
function getIconPathFromName(iconName: string): string {
  return iconName;
}
// ---cut---
import React from &quot;react&quot;;
import IconBase from &quot;./IconBase&quot;;

const icons = import.meta.glob&lt;{ default: typeof IconBase }&gt;(&quot;./icons/*.tsx&quot;);

export default function useIcon(
  iconName: string | undefined
): React.LazyExoticComponent&lt;typeof IconBase&gt; | undefined {
  if (iconName) {
    const iconPath = getIconPathFromName(iconName);
    const iconModule = icons[iconPath];
    if (iconModule) {
      return React.lazy(iconModule);
    }
  }
}

export const iconNames = Object.keys(icons);
</code></pre>
</div>
<pre class="shiki dark-plus twoslash lsp" style="background-color: #1E1E1E; color: #D4D4D4"><div class="language-id">tsx</div><div class='code-container'><code><div class='line'><span style="color: #6A9955">// @filename: icons/LightBulb.tsx</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) namespace React&#10;import React' >React</data-lsp></span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) function IconBase(props: IconProps): JSX.Element&#10;import IconBase' >IconBase</data-lsp></span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) type IconProps = {&#10;    string?: string | number | undefined;&#10;    className?: string | undefined;&#10;    color?: string | undefined;&#10;    height?: string | number | undefined;&#10;    id?: string | undefined;&#10;    lang?: string | undefined;&#10;    ... 463 more ...;&#10;    key?: React.Key | ... 1 more ... | undefined;&#10;}&#10;import IconProps' >IconProps</data-lsp></span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"../IconBase"</span><span style="color: #D4D4D4">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA"><data-lsp lsp='function LightBulbIcon(props: IconProps): JSX.Element' >LightBulbIcon</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) props: IconProps' >props</data-lsp></span><span style="color: #D4D4D4">: </span><span style="color: #4EC9B0"><data-lsp lsp='(alias) type IconProps = {&#10;    string?: string | number | undefined;&#10;    className?: string | undefined;&#10;    color?: string | undefined;&#10;    height?: string | number | undefined;&#10;    id?: string | undefined;&#10;    lang?: string | undefined;&#10;    ... 463 more ...;&#10;    key?: React.Key | ... 1 more ... | undefined;&#10;}&#10;import IconProps' >IconProps</data-lsp></span><span style="color: #D4D4D4">) {</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> (</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0"><data-lsp lsp='(alias) function IconBase(props: IconProps): JSX.Element&#10;import IconBase' >IconBase</data-lsp></span><span style="color: #808080">&gt;</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #808080">&lt;</span><span style="color: #569CD6"><data-lsp lsp='(property) JSX.IntrinsicElements.path: React.SVGProps&lt;SVGPathElement>' >path</data-lsp></span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(property) React.SVGAttributes&lt;T>.d?: string | undefined' >d</data-lsp></span><span style="color: #D4D4D4">=</span><span style="color: #CE9178">"..."</span><span style="color: #808080">&gt;&lt;/</span><span style="color: #569CD6"><data-lsp lsp='(property) JSX.IntrinsicElements.path: React.SVGProps&lt;SVGPathElement>' >path</data-lsp></span><span style="color: #808080">&gt;</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #808080">&lt;/</span><span style="color: #4EC9B0"><data-lsp lsp='(alias) function IconBase(props: IconProps): JSX.Element&#10;import IconBase' >IconBase</data-lsp></span><span style="color: #808080">&gt;</span></div><div class='line'><span style="color: #D4D4D4">  );</span></div><div class='line'><span style="color: #D4D4D4">}</span></div></code></div></pre>
<p>All of the 200+ icons are then re-exported from a single index file like so:</p>
<pre class="shiki dark-plus" style="background-color: #1E1E1E; color: #D4D4D4"><div class="language-id">typescript</div><div class='code-container'><code><div class='line'><span style="color: #6A9955">// @filename: index.tsx</span></div><div class='line'><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> { </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">as</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">LightBulbIcon</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./icons/LightBulb"</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #6A9955">// ...</span></div></code></div></pre>
<p>I am aware there are better ways of doing icons in React land, this project is a little special in that React is never run on the client, but that is beside the point. The problem here is with the way Vite works in a dev environment, it does not bundle source code, it does an HTTP request for every import and runs esbuild on each file to compile away TypeScript and JSX. This means that if we use a single icon from the index file it makes 200+ HTTP requests, which as you can imagine is a lot of overhead and very slow. So I started looking for solutions.</p>
<h2 id="initial-findings" tabindex="-1">Initial findings <a class="direct-link" href="#initial-findings" aria-hidden="true">#</a></h2>
<p>The first place I looked was the Vite docs, as I find them to be a great example of documentation and very easy to read. I quickly came across <a href="https://vitejs.dev/guide/dep-pre-bundling.html#dependency-pre-bundling">&quot;Dependency Pre-Bundling&quot;</a> which sounded like exactly what I need. It even speaks about the exact issue I am having &quot;Some packages ship their ES modules builds as many separate files importing one another.&quot;. So I started messing around with the <code>optimizeDeps</code> option, trying to get it to bundle my index file. This proved difficult, I could not get it to bundle the file no matter how I formatted the paths. It then occurred to me that all the docs on this subject are talking about <code>node_modules</code> or linked dependencies. So I did the next logical step and set up an alias to trick Vite into thinking it was a <code>node_module</code>, this still didn't seem to work, I can only assume Vite is very aware of what is source code and what isn't. So I had to come up with something else.</p>
<h2 id="a-three-pronged-approach" tabindex="-1">A three-pronged approach <a class="direct-link" href="#a-three-pronged-approach" aria-hidden="true">#</a></h2>
<p>After getting on with some other work, I thought about how I might solve this issue in the background. I eventually settled on a three-pronged attack on icons across the board.</p>
<h3 id="one:-direct-imports" tabindex="-1">One: Direct imports <a class="direct-link" href="#one:-direct-imports" aria-hidden="true">#</a></h3>
<p>Components that consume icons as a one-off can simply import the raw file, not the index. This means it will only load what it needs for each of these components.</p>
<h3 id="two:-lazy-loaded-modules" tabindex="-1">Two: Lazy-loaded modules <a class="direct-link" href="#two:-lazy-loaded-modules" aria-hidden="true">#</a></h3>
<p>For stories that have a control for the currently shown icon, we will dynamically import each of the icons, so they aren't requested until selected. This was surprisingly simple with Vite's <code>import.meta.glob</code> API and the <code>React.lazy</code> API. It looks something like this:</p>
<pre class="shiki dark-plus twoslash lsp" style="background-color: #1E1E1E; color: #D4D4D4"><div class="language-id">tsx</div><div class='code-container'><code><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) namespace React&#10;import React' >React</data-lsp></span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) function IconBase(props: IconProps): JSX.Element&#10;import IconBase' >IconBase</data-lsp></span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./IconBase"</span><span style="color: #D4D4D4">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF"><data-lsp lsp='const icons: Record&lt;string, () => Promise&lt;{&#10;    default: typeof IconBase;&#10;}>>' >icons</data-lsp></span><span style="color: #D4D4D4"> = </span><span style="color: #C586C0">import</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE"><data-lsp lsp='' style='border-bottom: solid 2px lightgrey;'>meta</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA"><data-lsp lsp='(property) ImportMeta.glob: ImportGlobFunction&#10;&lt;{&#10;    default: typeof IconBase;&#10;}>(glob: string | string[], options?: ImportGlobOptions&lt;false, string> | undefined) => Record&lt;string, () => Promise&lt;{&#10;    default: typeof IconBase;&#10;}>> (+2 overloads)' >glob</data-lsp></span><span style="color: #D4D4D4">&lt;{ </span><span style="color: #9CDCFE"><data-lsp lsp='(property) default: (props: IconProps) => JSX.Element' >default</data-lsp></span><span style="color: #D4D4D4">: </span><span style="color: #569CD6">typeof</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) function IconBase(props: IconProps): JSX.Element&#10;import IconBase' >IconBase</data-lsp></span><span style="color: #D4D4D4"> }&gt;(</span><span style="color: #CE9178">"./icons/*.tsx"</span><span style="color: #D4D4D4">);</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA"><data-lsp lsp='function useIcon(iconName: string | undefined): React.LazyExoticComponent&lt;typeof IconBase> | undefined' >useIcon</data-lsp></span><span style="color: #D4D4D4">(</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) iconName: string | undefined' >iconName</data-lsp></span><span style="color: #D4D4D4">: </span><span style="color: #4EC9B0">string</span><span style="color: #D4D4D4"> | </span><span style="color: #4EC9B0">undefined</span></div><div class='line'><span style="color: #D4D4D4">): </span><span style="color: #4EC9B0"><data-lsp lsp='(alias) namespace React&#10;import React' >React</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #4EC9B0"><data-lsp lsp='type React.LazyExoticComponent&lt;T extends React.ComponentType&lt;any>> = React.ExoticComponent&lt;React.ComponentPropsWithRef&lt;T>> &amp; {&#10;    readonly _result: T;&#10;}' >LazyExoticComponent</data-lsp></span><span style="color: #D4D4D4">&lt;</span><span style="color: #569CD6">typeof</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) function IconBase(props: IconProps): JSX.Element&#10;import IconBase' >IconBase</data-lsp></span><span style="color: #D4D4D4">&gt; | </span><span style="color: #4EC9B0">undefined</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) iconName: string | undefined' >iconName</data-lsp></span><span style="color: #D4D4D4">) {</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF"><data-lsp lsp='const iconPath: string' >iconPath</data-lsp></span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA"><data-lsp lsp='function getIconPathFromName(iconName: string): string' >getIconPathFromName</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) iconName: string' >iconName</data-lsp></span><span style="color: #D4D4D4">);</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF"><data-lsp lsp='const iconModule: () => Promise&lt;{&#10;    default: (props: IconProps) => JSX.Element;&#10;}>' >iconModule</data-lsp></span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE"><data-lsp lsp='const icons: Record&lt;string, () => Promise&lt;{&#10;    default: (props: IconProps) => JSX.Element;&#10;}>>' >icons</data-lsp></span><span style="color: #D4D4D4">[</span><span style="color: #9CDCFE"><data-lsp lsp='const iconPath: string' >iconPath</data-lsp></span><span style="color: #D4D4D4">];</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE"><data-lsp lsp='const iconModule: () => Promise&lt;{&#10;    default: (props: IconProps) => JSX.Element;&#10;}>' >iconModule</data-lsp></span><span style="color: #D4D4D4">) {</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) namespace React&#10;import React' >React</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA"><data-lsp lsp='function React.lazy&lt;(props: IconProps) => JSX.Element>(factory: () => Promise&lt;{&#10;    default: (props: IconProps) => JSX.Element;&#10;}>): React.LazyExoticComponent&lt;(props: IconProps) => JSX.Element>' >lazy</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE"><data-lsp lsp='const iconModule: () => Promise&lt;{&#10;    default: (props: IconProps) => JSX.Element;&#10;}>' >iconModule</data-lsp></span><span style="color: #D4D4D4">);</span></div><div class='line'><span style="color: #D4D4D4">    }</span></div><div class='line'><span style="color: #D4D4D4">  }</span></div><div class='line'><span style="color: #D4D4D4">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF"><data-lsp lsp='const iconNames: string[]' >iconNames</data-lsp></span><span style="color: #D4D4D4"> = </span><span style="color: #4EC9B0"><data-lsp lsp='var Object: ObjectConstructor' >Object</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA"><data-lsp lsp='(method) ObjectConstructor.keys(o: {}): string[] (+1 overload)' >keys</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE"><data-lsp lsp='const icons: Record&lt;string, () => Promise&lt;{&#10;    default: typeof IconBase;&#10;}>>' >icons</data-lsp></span><span style="color: #D4D4D4">);</span></div></code></div></pre>
<p>This gives us a hook that returns a lazy component or undefined given an icon name. We can then use it in our stories file:</p>
<pre class="shiki dark-plus twoslash lsp" style="background-color: #1E1E1E; color: #D4D4D4"><div class="language-id">tsx</div><div class='code-container'><code><div class='line'><span style="color: #6A9955">// @fil<data-lsp lsp='(alias) namespace React&#10;import React' >ename</data-lsp>: Icon.stories.tsx</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">React</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"react"</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">IconBase</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE">IconProps</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./IconBase"</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">useIcon</span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE"><data-lsp lsp='' style='border-bottom: solid 2px lightgrey;'></data-lsp>iconNames</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"./useIcon"</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">type</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE">StoryFn</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE">ComponentMeta</span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"@storybook/react"</span><span style="color: #D4D4D4">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) namespace React&#10;import React' ></data-lsp>title:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"Icon"</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">component:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">IconBase</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">argTypes:</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE">icon:</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">options:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">iconNames</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE">control:</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">        </span><span style="color: #9CDCFE">type:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"select"</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">      },</span></div><div class='line'><span style="color: #D4D4D4">    },</span></div><div class='line'><span style="color: #D4D4D4">  },</span></div><div class='line'><span style="color: #D4D4D4">} </span><span style="color: #C586C0">as</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">ComponentMeta</span><span style="color: #D4D4D4">&lt;</span><span style="color: #569CD6">typeof</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE">IconBase</span><span style="color: #D4D4D4">&gt;;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA">Template</span><span style="color: #D4D4D4">: </span><span style="color: #4EC9B0">StoryFn</span><span style="color: #D4D4D4">&lt;</span><span style="color: #4EC9B0">IconProps</span><span style="color: #D4D4D4"> & { </span><span style="color: #9CDCFE">icon</span><span style="color: #D4D4D4">?: </span><span style="color: #4EC9B0">string</span><span style="color: #D4D4D4"> }&gt; = (</span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF">icon</span><span style="color: #D4D4D4">, ...</span><span style="color: #4FC1FF">props</span><span style="color: #D4D4D4"> } = </span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">Icon</span><span style="color: #D4D4D4"> = </span><span style="color: #DCDCAA">useIcon</span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE">icon</span><span style="color: #D4D4D4">);</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #9CDCFE">Icon</span><span style="color: #D4D4D4">) {</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #808080">&lt;&gt;&lt;/&gt;</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">  }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #808080">&lt;</span><span style="color: #4EC9B0">Icon</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">{</span><span style="color: #D4D4D4">...</span><span style="color: #9CDCFE">props</span><span style="color: #569CD6">}</span><span style="color: #D4D4D4"> </span><span style="color: #808080">/&gt;</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">};</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> </span><span style="color: #4FC1FF">Default</span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE">Template</span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA">bind</span><span style="color: #D4D4D4">({});</span></div><div class='line'><span style="color: #9CDCFE">Default</span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE">args</span><span style="color: #D4D4D4"> = {</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #9CDCFE">icon:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">&quot;LightBulbIcon&quot;<data-lsp lsp='(property) type: string' ></data-lsp></span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">};</span></div></code></div></pre>
<p>Now when a user selects an icon name from the icon control in the Storybook interface, React will dynamically import the appropriate icon module and render it when it is available. Meaning only the default selected icon is loaded at runtime.</p>
<h3 id="three:-all-icon-reference" tabindex="-1">Three: All Icon Reference <a class="direct-link" href="#three:-all-icon-reference" aria-hidden="true">#</a></h3>
<p>For stories or documentation that show all the icons next to each other for reference, we still have the original issue. Since my previous attempts failed, I decided to go down a level of abstraction and write a plugin (at this point I just wanted things to work). Thankfully, Vite uses a plugin architecture borrowed from Rollup, which I have had a fair amount of experience writing in the past. Furthermore, we know it uses esbuild to transpile source code on the fly, so why not just do that for our index file. Below is roughly what the plugin looks like:</p>
<pre class="shiki dark-plus twoslash lsp" style="background-color: #1E1E1E; color: #D4D4D4"><div class="language-id">typescript</div><div class='code-container'><code><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) interface Plugin&#10;import Plugin' >Plugin</data-lsp></span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"vite"</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> { </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) function build(options: BuildOptions &amp; {&#10;    write: false;&#10;}): Promise&lt;BuildResult &amp; {&#10;    outputFiles: OutputFile[];&#10;}> (+4 overloads)&#10;import build' >build</data-lsp></span><span style="color: #D4D4D4"> } </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"esbuild"</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #C586C0">import</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">*</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">as</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) namespace path&#10;(alias) const path: PlatformPath&#10;import path' >path</data-lsp></span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">from</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"path"</span><span style="color: #D4D4D4">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #C586C0">export</span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">default</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">function</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA"><data-lsp lsp='function bundleIconsPlugin(): Plugin' >bundleIconsPlugin</data-lsp></span><span style="color: #D4D4D4">(): </span><span style="color: #4EC9B0"><data-lsp lsp='(alias) interface Plugin&#10;import Plugin' >Plugin</data-lsp></span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #569CD6">let</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='let command: string' >command</data-lsp></span><span style="color: #D4D4D4">: </span><span style="color: #4EC9B0">string</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">  </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #9CDCFE"><data-lsp lsp='(property) OutputPlugin.name: string' >name</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"bundle-icons"</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #DCDCAA"><data-lsp lsp='(property) Plugin_2.config?: ObjectHook&lt;(this: void, config: UserConfig, env: ConfigEnv) => void | UserConfig | Promise&lt;void | UserConfig | null> | null, {}> | undefined' >config</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) config: UserConfig' >config</data-lsp></span><span style="color: #D4D4D4">, { </span><span style="color: #9CDCFE"><data-lsp lsp='(property) ConfigEnv.command: "build" | "serve"' >command</data-lsp></span><span style="color: #D4D4D4">: </span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) _command: "build" | "serve"' >_command</data-lsp></span><span style="color: #D4D4D4"> }) {</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #9CDCFE"><data-lsp lsp='let command: string' >command</data-lsp></span><span style="color: #D4D4D4"> = </span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) _command: "build" | "serve"' >_command</data-lsp></span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">    },</span></div><div class='line'><span style="color: #D4D4D4">    </span><span style="color: #569CD6">async</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA"><data-lsp lsp='(property) Plugin_2.load?: ObjectHook&lt;(this: PluginContext, id: string, options?: {&#10;    ssr?: boolean | undefined;&#10;} | undefined) => LoadResult | Promise&lt;LoadResult>, {}> | undefined' >load</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) id: string' >id</data-lsp></span><span style="color: #D4D4D4">: </span><span style="color: #4EC9B0">string</span><span style="color: #D4D4D4">) {</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// Check we are serving, as this is a development mode optimisation.</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #6A9955">// Also check we are loading the index file.</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE"><data-lsp lsp='let command: string' >command</data-lsp></span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"serve"</span><span style="color: #D4D4D4"> && </span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) id: string' >id</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA"><data-lsp lsp='(method) String.endsWith(searchString: string, endPosition?: number | undefined): boolean' >endsWith</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"/Icon/index.tsx"</span><span style="color: #D4D4D4">)) {</span></div><div class='line'><span style="color: #D4D4D4">        </span><span style="color: #569CD6">const</span><span style="color: #D4D4D4"> { </span><span style="color: #4FC1FF"><data-lsp lsp='const outputFiles: OutputFile[]' >outputFiles</data-lsp></span><span style="color: #D4D4D4"> } = </span><span style="color: #C586C0">await</span><span style="color: #D4D4D4"> </span><span style="color: #DCDCAA"><data-lsp lsp='(alias) build(options: BuildOptions &amp; {&#10;    write: false;&#10;}): Promise&lt;BuildResult &amp; {&#10;    outputFiles: OutputFile[];&#10;}> (+4 overloads)&#10;import build' >build</data-lsp></span><span style="color: #D4D4D4">({</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE"><data-lsp lsp='(property) BuildOptions.entryPoints?: string[] | Record&lt;string, string> | undefined' >entryPoints</data-lsp>:</span><span style="color: #D4D4D4"> [</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) id: string' >id</data-lsp></span><span style="color: #D4D4D4">],</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE"><data-lsp lsp='(property) BuildOptions.bundle?: boolean | undefined' >bundle</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE"><data-lsp lsp='(property) CommonOptions.platform?: Platform | undefined' >platform</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"browser"</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE"><data-lsp lsp='(property) write: false' >write</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">false</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE"><data-lsp lsp='(property) CommonOptions.jsx?: "transform" | "preserve" | "automatic" | undefined' >jsx</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"preserve"</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE"><data-lsp lsp='(property) BuildOptions.absWorkingDir?: string | undefined' >absWorkingDir</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='var process: NodeJS.Process' >process</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA"><data-lsp lsp='(method) NodeJS.Process.cwd(): string' >cwd</data-lsp></span><span style="color: #D4D4D4">(),</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE"><data-lsp lsp='(property) CommonOptions.format?: Format | undefined' >format</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"esm"</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// We also need a custom esbuild plugin because we want to treat everything as</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #6A9955">// external apart from our individual icon files.</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #9CDCFE"><data-lsp lsp='(property) BuildOptions.plugins?: Plugin[] | undefined' >plugins</data-lsp>:</span><span style="color: #D4D4D4"> [</span></div><div class='line'><span style="color: #D4D4D4">            {</span></div><div class='line'><span style="color: #D4D4D4">              </span><span style="color: #9CDCFE"><data-lsp lsp='(property) Plugin.name: string' >name</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"externals"</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">              </span><span style="color: #DCDCAA"><data-lsp lsp='(property) Plugin.setup: (build: PluginBuild) => void | Promise&lt;void>' >setup</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) build: PluginBuild' >build</data-lsp></span><span style="color: #D4D4D4">) {</span></div><div class='line'><span style="color: #D4D4D4">                </span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) build: PluginBuild' >build</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA"><data-lsp lsp='(method) PluginBuild.onResolve(options: OnResolveOptions, callback: (args: OnResolveArgs) => OnResolveResult | Promise&lt;OnResolveResult | null | undefined> | null | undefined): void' >onResolve</data-lsp></span><span style="color: #D4D4D4">({ </span><span style="color: #9CDCFE"><data-lsp lsp='(property) OnResolveOptions.namespace?: string | undefined' >namespace</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #CE9178">"file"</span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE"><data-lsp lsp='(property) OnResolveOptions.filter: RegExp' >filter</data-lsp>:</span><span style="color: #D16969"> /.</span><span style="color: #D7BA7D">*</span><span style="color: #D16969">/</span><span style="color: #D4D4D4"> }, (</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) args: OnResolveArgs' >args</data-lsp></span><span style="color: #D4D4D4">) </span><span style="color: #569CD6">=&gt;</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">                  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) args: OnResolveArgs' >args</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE"><data-lsp lsp='(property) OnResolveArgs.kind: ImportKind' >kind</data-lsp></span><span style="color: #D4D4D4"> === </span><span style="color: #CE9178">"entry-point"</span><span style="color: #D4D4D4">) {</span></div><div class='line'><span style="color: #D4D4D4">                    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">                  }</span></div><div class='line'><span style="color: #D4D4D4">                  </span><span style="color: #6A9955">// If the file is in our icons folder use standard resolution.</span></div><div class='line'><span style="color: #D4D4D4">                  </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) args: OnResolveArgs' >args</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE"><data-lsp lsp='(property) OnResolveArgs.path: string' >path</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA"><data-lsp lsp='(method) String.startsWith(searchString: string, position?: number | undefined): boolean' >startsWith</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #CE9178">"./icons/"</span><span style="color: #D4D4D4">)) {</span></div><div class='line'><span style="color: #D4D4D4">                    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">                  } </span><span style="color: #C586C0">else</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">                    </span><span style="color: #6A9955">// Otherwise flag is external.</span></div><div class='line'><span style="color: #D4D4D4">                    </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> {</span></div><div class='line'><span style="color: #D4D4D4">                      </span><span style="color: #9CDCFE"><data-lsp lsp='(property) OnResolveResult.path?: string | undefined' >path</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='(alias) namespace path&#10;(alias) const path: PlatformPath&#10;import path' >path</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #DCDCAA"><data-lsp lsp='(method) path.PlatformPath.join(...paths: string[]): string' >join</data-lsp></span><span style="color: #D4D4D4">(</span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) args: OnResolveArgs' >args</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE"><data-lsp lsp='(property) OnResolveArgs.resolveDir: string' >resolveDir</data-lsp></span><span style="color: #D4D4D4">, </span><span style="color: #9CDCFE"><data-lsp lsp='(parameter) args: OnResolveArgs' >args</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE"><data-lsp lsp='(property) OnResolveArgs.path: string' >path</data-lsp></span><span style="color: #D4D4D4">),</span></div><div class='line'><span style="color: #D4D4D4">                      </span><span style="color: #9CDCFE"><data-lsp lsp='(property) OnResolveResult.external?: boolean | undefined' >external</data-lsp>:</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">true</span><span style="color: #D4D4D4">,</span></div><div class='line'><span style="color: #D4D4D4">                    };</span></div><div class='line'><span style="color: #D4D4D4">                  }</span></div><div class='line'><span style="color: #D4D4D4">                });</span></div><div class='line'><span style="color: #D4D4D4">              },</span></div><div class='line'><span style="color: #D4D4D4">            },</span></div><div class='line'><span style="color: #D4D4D4">          ],</span></div><div class='line'><span style="color: #D4D4D4">        });</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// Make sure we build something.</span></div><div class='line'><span style="color: #D4D4D4">        </span><span style="color: #C586C0">if</span><span style="color: #D4D4D4"> (!</span><span style="color: #9CDCFE"><data-lsp lsp='const outputFiles: OutputFile[]' >outputFiles</data-lsp></span><span style="color: #D4D4D4"> || </span><span style="color: #9CDCFE"><data-lsp lsp='const outputFiles: OutputFile[]' >outputFiles</data-lsp></span><span style="color: #D4D4D4">.</span><span style="color: #9CDCFE"><data-lsp lsp='(property) Array&lt;OutputFile>.length: number' >length</data-lsp></span><span style="color: #D4D4D4"> !== </span><span style="color: #B5CEA8">1</span><span style="color: #D4D4D4">) {</span></div><div class='line'><span style="color: #D4D4D4">          </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">        }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #D4D4D4">        </span><span style="color: #6A9955">// Return the bundled file contents.</span></div><div class='line'><span style="color: #D4D4D4">        </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #9CDCFE"><data-lsp lsp='const outputFiles: OutputFile[]' >outputFiles</data-lsp></span><span style="color: #D4D4D4">[</span><span style="color: #B5CEA8">0</span><span style="color: #D4D4D4">].</span><span style="color: #9CDCFE"><data-lsp lsp='(property) OutputFile.text: string' >text</data-lsp></span><span style="color: #D4D4D4"> </span><span style="color: #C586C0">as</span><span style="color: #D4D4D4"> </span><span style="color: #4EC9B0">string</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">      }</span></div><div class='line'><span style="color: #D4D4D4">      </span><span style="color: #C586C0">return</span><span style="color: #D4D4D4"> </span><span style="color: #569CD6">null</span><span style="color: #D4D4D4">;</span></div><div class='line'><span style="color: #D4D4D4">    },</span></div><div class='line'><span style="color: #D4D4D4">  };</span></div><div class='line'><span style="color: #D4D4D4">}</span></div></code></div></pre>
<h2 id="conclusion" tabindex="-1">Conclusion <a class="direct-link" href="#conclusion" aria-hidden="true">#</a></h2>
<p>And that is it. Three approaches that work in tandem to make Storybook DX so much nicer with large icon sets! I hope this blog post inspired you or solved a problem you were having, either way, thanks for reading.</p>

  <hr>
  <ul><li>Next: <a href="/blog/posts/native-macos-vscode-tabs/">Did you know about native macOS tabs in vscode?</a></li><li>Previous: <a href="/blog/posts/globs-are-builtin/">Globs are built-in!</a></li>
  </ul>
</section>

    </main>

    
      <footer>
        <ul class="icons">
          <li>
            <a aria-labelledby="twitter__title" href="https://twitter.com/AndrewJLeedham">
              <svg role="img" width="24px" height="24px" fill="#000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <title id="twitter__title">See Andrew Leedham's Twitter</title>
                <path fill="currentColor" d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z"></path>
              </svg>
            </a>
          </li>
          <li>
            <a aria-labelledby="linkedin__title" href="https://www.linkedin.com/in/andrew-leedham-ba864b112/">
              <svg role="img" width="24px" height="24px" fill="#000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <title id="linkedin__title">See Andrew Leedham's Linked In</title>
                <path fill="currentColor" d="M19 3A2 2 0 0 1 21 5V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H19M18.5 18.5V13.2A3.26 3.26 0 0 0 15.24 9.94C14.39 9.94 13.4 10.46 12.92 11.24V10.13H10.13V18.5H12.92V13.57C12.92 12.8 13.54 12.17 14.31 12.17A1.4 1.4 0 0 1 15.71 13.57V18.5H18.5M6.88 8.56A1.68 1.68 0 0 0 8.56 6.88C8.56 5.95 7.81 5.19 6.88 5.19A1.69 1.69 0 0 0 5.19 6.88C5.19 7.81 5.95 8.56 6.88 8.56M8.27 18.5V10.13H5.5V18.5H8.27Z"></path>
              </svg>
            </a>
          </li>
          <li>
            <a aria-labelledby="github__title" href="https://github.com/AndrewLeedham">
              <svg role="img" width="24px" height="24px" fill="#000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <title id="github__title">Andrew Leedham's GitHub</title>
                <path fill="currentColor" d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
              </svg>
            </a>
          </li>
          <li>
            <a aria-labelledby="stack-overflow__title" href="http://stackoverflow.com/users/2386508/andrew-leedham">
              <svg role="img" width="24px" height="24px" fill="#000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <title id="stack-overflow__title">See Andrew Leedham's Stack Overflow</title>
                <path fill="currentColor" d="M17.36,20.2V14.82H19.15V22H3V14.82H4.8V20.2H17.36M6.77,14.32L7.14,12.56L15.93,14.41L15.56,16.17L6.77,14.32M7.93,10.11L8.69,8.5L16.83,12.28L16.07,13.9L7.93,10.11M10.19,6.12L11.34,4.74L18.24,10.5L17.09,11.87L10.19,6.12M14.64,1.87L20,9.08L18.56,10.15L13.2,2.94L14.64,1.87M6.59,18.41V16.61H15.57V18.41H6.59Z"></path>
              </svg>
            </a>
          </li>
        </ul>
      </footer>
    

    <!-- Current page: /blog/posts/optimising-icon-loading-with-storybook-and-vite/ -->
  </body>
</html>